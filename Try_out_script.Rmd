---
title: "Try_out_script"
author: "Lisa Pramann"
date: "14 10 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Brainstorming Doc for our group: https://docs.google.com/document/d/1C7mcBF1EI7lNGgmfcYm6pfME6kO3Kqlyja4HmVLRaU4/edit
test


# Importing the relevant libraries 
```{r}

library(sf)          # classes and functions for vector data
library(terra)      # classes and functions for raster data
library(spData)        # load geographic data
library(spDataLarge) # load larger geographic data
library(terra)
library(tmap)    # for static and interactive maps
library(leaflet) # for interactive maps
library(ggplot2) # tidyverse data visualization package
library(tidyverse)

?sf
```


Here L (Lisa) just try out some elements of https://geocompr.robinlovelace.net/spatial-class.html#crs-intro

```{r}
vector_filepath = system.file("shapes/world.gpkg", package = "spData")
new_vector = read_sf(vector_filepath)
st_crs(new_vector) # get CRS

crs(new_vector) # get CRS

luxembourg = world[world$name_long == "Luxembourg", ]
st_area(luxembourg) # requires the s2 package in recent versions of sf
#> 2.41e+09 [m^2]

world%>% 
  summarise(geom)

wrld <- st_as_sf(maps::map("world", fill = TRUE, plot = FALSE))
wrld_wrap <- st_wrap_dateline(wrld, options = c("WRAPDATELINE=YES", "DATELINEOFFSET=180"),
   quiet = TRUE)
wrld_moll <- st_transform(wrld_wrap, "+proj=moll")
plot(st_geometry(wrld_moll), col = "transparent")


#Spatial data operations
elev = rast(system.file("raster/elev.tif", package = "spData"))
grain = rast(system.file("raster/grain.tif", package = "spData"))

The new zealand Example 
canterbury = nz %>% filter(Name == "Canterbury")
canterbury_height = nz_height[canterbury, ]
nz_height[canterbury, , op = st_disjoint]

sel_sgbp = st_intersects(x = nz_height, y = canterbury)
class(sel_sgbp)
#> [1] "sgbp" "list"
sel_logical = lengths(sel_sgbp) > 0
canterbury_height2 = nz_height[sel_logical, ]

canterbury_height3 = nz_height %>%
  filter(st_intersects(x = ., y = canterbury, sparse = FALSE))
```


Chunk used by Lisa to try out different things for the presentation (how to acess data)

```{r}
#Import Wolrd Data 
world_data <- world
glimpse(world_data)

#Data Set includes 11 variables of which the geom stores the data 
#One can do general data wrangling with dplyr, string, etc. and doing attribute data operations 

#Filter for big countries 

world %>%
  filter(area_km2 > 1000000)

world %>% 
  dplyr::select(area_km2, continent) %>% 
  group_by(continent) %>% 
  summarize(area_km2 = sum(area_km2, na.rm = TRUE), n_countries = n()) %>% 
  top_n(n = 5, wt = area_km2) %>%
  arrange(desc(area_km2)) %>%
  st_drop_geometry() # excludes geometric data from analysis 

# Utilize Units from sf 

Germany = world[world$name_long == "Germany", ]
st_area(Germany)
units::set_units(st_area(Germany), km^2)


# Use Joins
#Example 1
Population = left_join(world, worldbank_df)
class(Population)
plot(Population["pop_growth"])

#Example 2
us_income = left_join(us_states, us_states_df,
                      by = c("NAME" = "state"))
class(us_income)
plot(us_income["median_income_15"])


```

#Spatial Data Operations 

Notes (for slides)
- many spatial operations have a non-spatial attribute 
- If use spatial operations with two spatial objects make sure that they have the same CRS 
(show how?)


```{r}
#Spatial subsetting Example

Europe <- world %>% 
  filter(continent == "Europe")

#Example from book - maybe find different example 
canterbury = nz %>% filter(Name == "Canterbury")
canterbury_height = nz_height[canterbury, ]


```


Measuring distances
While topological relations are binary — a feature either intersects with another or does not — distance relations are continuous. The distance between two objects is calculated with the st_distance() function. 
There are two potentially surprising things about the result:
It has units, telling us the distance is 100,000 meters, not 100,000 inches, or any other measure of distance
It is returned as a matrix, even though the result only contains a single value
```{r}
#Measuring Distances 

#Example from book 
canterbury = nz %>% filter(Name == "Canterbury")
nz_heighest = nz_height %>% top_n(n = 1, wt = elevation)
canterbury_centroid = st_centroid(canterbury)
st_distance(nz_heighest, canterbury_centroid)

```

Mapping with sf - plot()
```{r}
plot(world["continent"], reset = FALSE)
cex = sqrt(world$pop) / 10000
world_cents = st_centroid(world, of_largest = TRUE)
plot(st_geometry(world_cents), add = TRUE, cex = cex)


Germany = world[world$name_long == "Germany", ]
plot(st_geometry(Germany), expandBB = c(0, 0.2, 0.1, 1), col = "orange", lwd = 3)
plot(Europe[0], add = TRUE)

```

